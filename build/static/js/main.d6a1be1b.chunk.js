(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{248:function(e,t,n){e.exports=n(249)},249:function(e,t,n){"use strict";n.r(t);n(250),n(251);var a=document.getElementById("picture"),r=document.getElementById("headertext"),o=document.getElementById("instructortext");o.innerHTML="Loading",n(225).setBackend("cpu");var i=n(272),c=null,s=null,l=document.getElementsByTagName("video")[0],d=window.navigator.mozCameras.getListOfCameras()[1],u={},m={pictureSize:null,fileFormat:null};function g(e){console.warn(e)}function f(){null!=s&&s.release(),navigator.mozCameras.getCamera(d,u).then(function(e){s=e.camera,l.mozSrcObject=s,l.play()},g)}function p(){var e=["neutral","happy","sad","angry","surprised"][Math.floor(5*Math.random())];return o.innerHTML="Show "+e+" expression",e}function v(e,t){e.setItem("saved5",e.getItem("saved4")),e.setItem("saved4",e.getItem("saved3")),e.setItem("saved3",e.getItem("saved2")),e.setItem("saved2",e.getItem("saved1")),e.setItem("saved1",t)}Promise.all([i.nets.faceRecognitionNet.loadFromUri("./models"),i.nets.faceLandmark68TinyNet.loadFromUri("./models"),i.nets.faceExpressionNet.loadFromUri("./models"),i.nets.tinyFaceDetector.loadFromUri("./models")]).then(function(){null==window.localStorage.getItem("descriptor")?(r.innerHTML="Enrol",console.log("Ready"),f(),o.innerHTML="Take Picture",a.addEventListener("click",function(){function e(e){o.innerHTML="Working",console.log(e);var t=URL.createObjectURL(e),n=new Image;n.src=t,c=n,console.log("Image loaded"),console.log(c);try{setTimeout(function(){alert("Face not detected.\nTry again."),o.innerHTML="Take Picture",f()},9e4);var a=i.detectSingleFace(c,new i.TinyFaceDetectorOptions).withFaceLandmarks(!0).withFaceDescriptor();a.then(function(e){console.log(e.descriptor);var t=JSON.stringify(e.descriptor);console.log("saving...");var n=window.localStorage;v(n,t),n.setItem("descriptor",t),o.innerHTML="Done",window.location.reload()})}catch(r){alert("Face not detected.\nTry again."),o.innerHTML="Take Picture",f()}}function t(e){o.innerHTML="Camera Error"}o.innerHTML="Hold",s.release(),navigator.mozCameras.getCamera(d,u).then(function(n){s=n.camera,m.pictureSize=s.capabilities.pictureSizes[0],m.fileformat=s.capabilities.fileFormats[0],s.takePicture(m).then(e,t)},g)})):function(){r.innerHTML="Authenticate";var e=window.localStorage,t=e.getItem("descriptor"),n=[],l=JSON.parse(t);for(var h in l)n.push(l[h]);var w=Float32Array.from(n);(n=[]).push(w);var T=new i.LabeledFaceDescriptors("john",n),L=new i.FaceMatcher(T,.4),I=[],F=function(e){var t=[];null!=e.getItem("saved1")?t.push(e.getItem("saved1")):null!=e.getItem("saved2")?t.push(e.getItem("saved2")):null!=e.getItem("saved3")?t.push(e.getItem("saved3")):null!=e.getItem("saved4")?t.push(e.getItem("saved4")):null!=e.getItem("saved5")&&t.push(e.getItem("saved5"));return t}(e);console.log(F),F.forEach(function(e){for(var t in console.log(e),n=[],l=JSON.parse(e))n.push(l[t]);w=Float32Array.from(n),(n=[]).push(w),console.log(n),I.push(new i.LabeledFaceDescriptors("",n))});var y=new i.FaceMatcher(I,.1),M=p();console.log("Loaded"),f(),a.addEventListener("click",function(){function t(t){o.innerHTML="Working";var n=URL.createObjectURL(t),a=new Image;a.src=n,c=a,console.log("Image loaded"),console.log(c);try{setTimeout(function(){alert("Face not detected.\nTry again."),window.location.reload()},9e4);var r=i.detectSingleFace(c,new i.TinyFaceDetectorOptions).withFaceLandmarks(!0).withFaceExpressions().withFaceDescriptor();r.then(function(t){console.log(t.descriptor);var n=t.expressions.asSortedArray();if(console.log(n[0].expression),n[0].probability>=.4&&n[0].expression===M){var a=L.findBestMatch(t.descriptor),r=a.distance,o=y.findBestMatch(t.descriptor),i=o.distance;if(r<=.4&&r>=.1&&i>=.1){alert("User Verified");var c=JSON.stringify(t.descriptor);v(e,c)}else alert("Verification failed. \nTry again."),M=p(),window.location.reload()}else alert("Liveness Test Failed. \nTry again"),M=p(),window.location.reload()})}catch(s){alert("Face not detected.\nTry again."),o.innerHTML="Take Picture",f()}}function n(e){o.innerHTML="Camera Error"}o.innerHTML="Hold",s.release(),navigator.mozCameras.getCamera(d,u).then(function(e){s=e.camera,m.pictureSize=s.capabilities.pictureSizes[0],m.fileformat=s.capabilities.fileFormats[0],s.takePicture(m).then(t,n)},g)})}()})},251:function(e,t,n){},258:function(e,t){},259:function(e,t){},267:function(e,t){},270:function(e,t){},271:function(e,t){}},[[248,1,2]]]);
//# sourceMappingURL=main.d6a1be1b.chunk.js.map